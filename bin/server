#!/usr/bin/env ruby
argv = %w{ s -b 0.0.0.0 -p 39102 }

root_path   = File.expand_path File.join(File.dirname(__FILE__), '..')
assets_path = File.join(root_path, 'public', 'assets')

if ARGV.include?('p')
  ENV['RAILS_LOG_TO_STDOUT'] = 'true'
  argv.concat %w{ -e production }
  unless File.exist?(assets_path)
    puts '=> recompiling assets...'
    system File.join('bin', 'recompile-assets'), chdir: root_path
  end
elsif File.exist?(assets_path)
  puts '=> removing precompiled assets...'
  require 'fileutils'
  FileUtils.rm_rf assets_path
end

ARGV.delete 'p'
argv.concat ARGV

ARGV.replace argv
load File.join(File.dirname(__FILE__), 'rails')
